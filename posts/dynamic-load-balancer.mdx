---
title: '­ЪћЦ Рџћ№ИЈ Build Dynamic Load Balancer '
publishedAt: '2023-09-25'
summary: '­ЪћЦ Рџћ№ИЈ Unravel the mysteries of Architecture'
---

## рЃерЃћрЃАрЃљрЃЋрЃљрЃџрЃў
рЃњрЃљрЃЏрЃљрЃарЃ»рЃЮрЃЉрЃљ, рЃћрЃА рЃљрЃарЃўрЃА рЃЕрЃћрЃЏрЃў рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃАрЃбрЃљрЃбрЃўрЃљ рЃЦрЃљрЃарЃЌрЃБрЃџ рЃћрЃюрЃљрЃќрЃћ рЃЊрЃљ рЃарЃЮрЃњрЃЮрЃарЃф рЃАрЃљрЃЌрЃљрЃБрЃарЃўрЃЊрЃљрЃю рЃЕрЃљрЃюрЃА, рЃљрЃЏ рЃАрЃбрЃљрЃбрЃўрЃљрЃерЃў рЃЏрЃўрЃюрЃЊрЃљ рЃЋрЃўрЃАрЃљрЃБрЃЉрЃарЃЮ `dynamic load balancer`-рЃќрЃћ рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ рЃћрЃарЃЌрЃљрЃЊ 
рЃЊрЃљрЃЋрЃгрЃћрЃарЃЮрЃЌ `nodejs`-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ.

## Dynamic horizontal Scaling

рЃћрЃарЃЌ-рЃћрЃарЃЌрЃў рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃБрЃърЃўрЃарЃљрЃбрЃћрЃАрЃЮрЃЉрЃљ, рЃарЃљрЃф рЃЦрЃџрЃљрЃБрЃЊрЃќрЃћ рЃЊрЃљрЃцрЃБрЃФрЃюрЃћрЃЉрЃБрЃџ рЃўрЃюрЃцрЃарЃљрЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃА рЃљрЃЦрЃЋрЃА рЃљрЃарЃўрЃА рЃўрЃА рЃарЃЮрЃЏ, рЃЏрЃљрЃЌ рЃерЃћрЃБрЃФрЃџрЃўрЃљрЃЌ рЃЊрЃўрЃюрЃљрЃЏрЃўрЃБрЃарЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃБрЃДрЃЮрЃю рЃарЃљрЃЏрЃ«рЃћрЃџрЃљ рЃарЃћрЃАрЃБрЃарЃАрЃўрЃф
рЃАрЃГрЃарЃўрЃЊрЃћрЃЉрЃљ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃўрЃљрЃА, рЃўрЃЏрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ рЃЌрЃБ рЃарЃљ рЃбрЃарЃћрЃцрЃўрЃЎрЃў рЃЏрЃЮрЃЊрЃўрЃА рЃЏрЃљрЃАрЃќрЃћ. `Dynamic scaling`-рЃўрЃЌрЃљрЃф рЃљрЃарЃўрЃА рЃфрЃюрЃЮрЃЉрЃўрЃџрЃў рЃћрЃА рЃАрЃљрЃЎрЃўрЃЌрЃ«рЃў. рЃЌрЃБ рЃАрЃгрЃЮрЃарЃљрЃЊ рЃЊрЃљрЃЋрЃљрЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃарЃћрЃЉрЃЌ, рЃљрЃЏ рЃЏрЃўрЃЊрЃњрЃЮрЃЏрЃљрЃЏ
рЃерЃћрЃАрЃљрЃФрЃџрЃЮрЃљ рЃАрЃљрЃњрЃарЃФрЃюрЃЮрЃЉрЃџрЃљрЃЊ рЃерЃћрЃљрЃЏрЃфрЃўрЃарЃЮрЃА `IT` рЃўрЃюрЃцрЃарЃљрЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃўрЃА рЃцрЃљрЃАрЃў, рЃўрЃАрЃћ рЃарЃЮрЃЏ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ рЃўрЃАрЃћрЃЋ `highly available - рЃЏрЃљрЃдрЃљрЃџ рЃ«рЃћрЃџрЃЏрЃўрЃАрЃгрЃљрЃЋрЃЊрЃЮрЃЏрЃў` рЃЊрЃљрЃарЃЕрЃћрЃА.


## Idea

рЃўрЃЊрЃћрЃљ рЃљрЃарЃўрЃА рЃЏрЃљрЃарЃбрЃўрЃЋрЃў: рЃЌрЃБ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљрЃА рЃљрЃЦрЃЋрЃА рЃърЃћрЃарЃцрЃЮрЃарЃЏрЃљрЃюрЃАрЃўрЃА рЃЋрЃљрЃарЃЊрЃюрЃљ рЃЏрЃљрЃдрЃљрЃџрЃў рЃбрЃарЃћрЃцрЃўрЃЎрЃўрЃА рЃњрЃљрЃЏрЃЮ, рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃЏрЃарЃљрЃЋрЃџрЃћрЃЉрЃА рЃЏрЃўрЃА рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃбрЃћрЃЉрЃА рЃљрЃ«рЃљрЃџ рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ, рЃарЃЮрЃЏ рЃњрЃљрЃБрЃЏрЃЎрЃџрЃљрЃЋрЃЊрЃћрЃА рЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљрЃА.
рЃљрЃюрЃљрЃџрЃЮрЃњрЃўрЃБрЃарЃљрЃЊ, рЃЌрЃБ рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџрЃў рЃарЃћрЃАрЃБрЃарЃАрЃћрЃЉрЃў рЃЋрЃћрЃа рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ, рЃќрЃћрЃЊрЃЏрЃћрЃбрЃўрЃљ, рЃЏрЃљрЃерЃўрЃю рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЋрЃарЃЌрЃЮрЃЌ рЃќрЃЮрЃњрЃўрЃћрЃарЃЌрЃў рЃЏрЃљрЃЌрЃњрЃљрЃюрЃў, рЃарЃЮрЃЏ рЃерЃћрЃЋрЃљрЃЏрЃфрЃўрЃарЃЮрЃЌ рЃ«рЃљрЃарЃ»рЃў.

рЃћрЃА рЃАрЃЎрЃљрЃџрЃўрЃарЃћрЃЉрЃљ рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃњрЃЋрЃЦрЃЮрЃюрЃЊрЃћрЃА рЃЊрЃљрЃерЃћрЃЊрЃБрЃџрЃћрЃЉрЃБрЃџрЃў, рЃарЃљрЃф рЃўрЃЏрЃљрЃА рЃюрЃўрЃерЃюрЃљрЃЋрЃА, рЃарЃЮрЃЏ рЃарЃљрЃдрЃљрЃф рЃАрЃљрЃљрЃЌрЃћрЃЉрЃерЃў рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃњрЃљрЃЏрЃЮрЃЋрЃарЃЌрЃЮрЃЌ рЃарЃЮрЃЏрЃћрЃџрЃўрЃдрЃљрЃф рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃў, рЃарЃљрЃЊрЃњрЃљрЃю рЃЋрЃўрЃфрЃўрЃЌ рЃарЃЮрЃЏ рЃљрЃЏ рЃърЃћрЃарЃўрЃЮрЃЊрЃерЃў рЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљ рЃФрЃљрЃџрЃўрЃљрЃю рЃўрЃЎрЃџрЃћрЃЉрЃА 
рЃЊрЃљ рЃЊрЃљрЃЋрЃљрЃарЃћрЃАрЃбрЃљрЃарЃбрЃЮрЃЌ рЃарЃЮрЃњрЃЮрЃарЃф рЃЎрЃў рЃЊрЃљрЃўрЃгрЃДрЃћрЃЉрЃљ рЃўрЃА рЃАрЃљрЃљрЃЌрЃЉрЃў, рЃарЃЮрЃфрЃљ рЃЊрЃљрЃгрЃЮрЃџрЃљ рЃЏрЃљрЃдрЃљрЃџрЃўрЃљ.


## Service Registry

рЃќрЃЮрЃњрЃљрЃЊрЃў рЃърЃљрЃбрЃћрЃарЃюрЃў, рЃарЃЮрЃЏ рЃћрЃА рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ рЃњрЃљрЃЊрЃљрЃЋрЃГрЃарЃљрЃЌ рЃљрЃарЃўрЃА, рЃарЃЮрЃЏ рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃЮрЃЌ рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃБрЃарЃў рЃарЃћрЃърЃЮрЃќрЃўрЃбрЃЮрЃарЃў - `service registry`, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃўрЃюрЃљрЃ«рЃљрЃЋрЃА рЃЊрЃљ рЃЊрЃљрЃбрЃарЃћрЃЎрЃљрЃЋрЃА, рЃарЃЮрЃЏрЃћрЃџрЃў рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃљ рЃњрЃљрЃерЃЋрЃћрЃЉрЃБрЃџрЃў рЃЊрЃљ
рЃарЃЮрЃЏрЃћрЃџрЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃў рЃљрЃЏ рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћ.
<Image
  alt={`Functional Programming Paradigm`}
  src={`/images/dynamic-load-balancer.png`}
  width={1065}
  height={557}
/>

рЃарЃЮрЃњрЃЮрЃарЃф рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃўрЃЊрЃљрЃю рЃЕрЃљрЃюрЃА, рЃарЃЮрЃфрЃљ рЃарЃћрЃЦрЃЋрЃћрЃЦрЃАрЃбрЃў рЃЏрЃўрЃЋрЃљ `example.com`-рЃќрЃћ, рЃџрЃЮрЃљрЃЊ рЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃарЃў рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃарЃћрЃЦрЃЋрЃћрЃАрЃбрЃўрЃА рЃърЃарЃћрЃцрЃўрЃЦрЃАрЃА, рЃЌрЃБ рЃўрЃгрЃДрЃћрЃЉрЃљ `/api`-рЃўрЃЌ рЃћрЃАрЃўрЃњрЃў рЃарЃћрЃЦрЃЋрЃћрЃАрЃбрЃў
рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃЉрЃљрЃџрЃљрЃюрЃАрЃЊрЃћрЃА `API service` рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃћрЃЉрЃќрЃћ, рЃарЃЮрЃњрЃЮрЃарЃф рЃЋрЃ«рЃћрЃЊрЃљрЃЋрЃЌ рЃАрЃБрЃџ `API`-рЃАрЃЌрЃЋрЃўрЃА рЃњрЃЋрЃљрЃЦрЃЋрЃА рЃЮрЃарЃў рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃў, рЃЮрЃарЃњрЃљрЃю рЃњрЃЋрЃљрЃЦрЃЋрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃБрЃџрЃў рЃћрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃў, `api1`-рЃќрЃћ рЃЊрЃљ `api2`-рЃќрЃћ.


## Implementing a dynamic load balancer with http-proxy and Consul

рЃАрЃћрЃарЃЋрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃбрЃЮрЃарЃљрЃЊ рЃЋрЃўрЃДрЃћрЃюрЃћрЃЉ [Consul](https://www.consul.io/)-рЃА, рЃљрЃЦ рЃЏрЃћрЃбрЃА рЃљрЃдрЃљрЃа рЃерЃћрЃЋрЃљрЃџ рЃЊрЃћрЃбрЃљрЃџрЃћрЃЉрЃерЃў, рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ рЃюрЃљрЃ«рЃЮрЃЌ рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ. рЃЎрЃЮрЃюрЃАрЃБрЃџрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃљрЃќрЃарЃўрЃљ, рЃарЃЮрЃЏ
рЃњрЃљрЃЋрЃўрЃЏрЃћрЃЮрЃарЃЮрЃЌ рЃўрЃА рЃЏрЃБрЃџрЃбрЃўрЃАрЃћрЃарЃЋрЃўрЃАрЃБрЃџрЃў рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃќрЃћрЃЏрЃЮрЃЌ рЃљрЃдрЃгрЃћрЃарЃўрЃџ рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃљрЃќрЃћрЃљ. рЃАрЃБрЃџ рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃћрЃЉ 3 рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃљрЃА:

<InfoCard type='success' messages={['http-proxy - рЃњрЃљрЃЋрЃљрЃЏрЃљрЃарЃбрЃўрЃЋрЃЮрЃЌ reverse-proxy/load-balancer-рЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ рЃюрЃЮрЃБрЃЊрЃќрЃћ','portfinder: рЃљрЃЏрЃљрЃА рЃљрЃ«рЃАрЃюрЃљ рЃљрЃа рЃБрЃюрЃЊрЃљ,рЃАрЃљрЃ«рЃћрЃџрЃў рЃњрЃЋрЃћрЃБрЃЉрЃюрЃћрЃЉрЃљ','consul: рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃфрЃўрЃљ рЃарЃЮрЃЏ рЃњрЃЋрЃЦрЃЮрЃюрЃЊрЃћрЃА Consul-рЃЌрЃљрЃю']} title='рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃћрЃЉрЃў, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃАрЃљрЃф рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃћрЃЉ'/>


рЃЏрЃЮрЃЊрЃў рЃњрЃљрЃЊрЃљрЃЋрЃўрЃЊрЃћрЃЌ рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃўрЃА рЃюрЃљрЃгрЃўрЃџрЃќрЃћ рЃБрЃерЃБрЃљрЃџрЃЮрЃЊ. 

## Setting up the Service For Registration

рЃЊрЃљрЃЋрЃгрЃћрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃбрЃЮрЃарЃў, рЃљрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃА рЃЏрЃўрЃЋрЃўрЃдрЃћрЃЉрЃЌ `command-line`-рЃЊрЃљрЃю.
рЃЏрЃЮрЃЊрЃў рЃЊрЃљрЃЋрЃўрЃгрЃДрЃЮрЃЌ рЃЊрЃљ рЃЌрЃљрЃю рЃљрЃЋрЃ«рЃАрЃюрЃљрЃЌ. 

```js title="app.js"
import { createServer } from 'http';
import Consul from 'consul';
import portfinder from 'portfinder';
import { nanoid } from 'nanoid';


// рЃЊрЃљрЃЋрЃўрЃГрЃўрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃбрЃўрЃърЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃЌ
const serviceType = process.argv[2];

const { pid } = process;

```


рЃљрЃ«рЃџрЃљ рЃњрЃЋрЃўрЃюрЃЊрЃљ, рЃарЃЮрЃЏ рЃЊрЃљрЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃАрЃў, рЃарЃЮрЃЏрЃџрЃўрЃА рЃбрЃўрЃърЃў рЃЋрЃўрЃфрЃўрЃЌ(рЃАрЃљрЃ«рЃћрЃџрЃўрЃф рЃерЃћрЃњрЃЋрЃўрЃФрЃџрЃўрЃљ рЃЋрЃЌрЃЦрЃЋрЃљрЃЌ), рЃњрЃЋрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ рЃБрЃЎрЃЋрЃћ 
рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљ рЃњрЃљрЃЋрЃБрЃЎрЃћрЃЌрЃЮрЃЌ рЃЎрЃЮрЃюрЃАрЃБрЃџрЃА,рЃњрЃљрЃЋрЃљрЃбрЃљрЃюрЃЮрЃЌ рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃарЃў `id`, рЃАрЃљрЃ«рЃћрЃџрЃў рЃљрЃЏ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА, рЃЏрЃЮрЃЋрЃФрЃћрЃЉрЃюрЃЮрЃЌ рЃЌрЃљрЃЋрЃўрЃАрЃБрЃцрЃљрЃџрЃў рЃърЃЮрЃарЃбрЃў рЃарЃЮрЃЏрЃћрЃџрЃќрЃћрЃф рЃњрЃЋрЃўрЃюрЃЊрЃљ рЃЕрЃЋрЃћрЃюрЃў рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃў рЃњрЃљрЃћрЃерЃЋрЃљрЃА, рЃЊрЃљ рЃбрЃћрЃњрЃћрЃЉрЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃа рЃљрЃарЃўрЃА рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ,
рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃљрЃЊ рЃбрЃћрЃњрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃЏрЃўрЃќрЃљрЃюрЃўрЃљ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃќрЃљрЃфрЃўрЃљ рЃњрЃљрЃарЃЎрЃЋрЃћрЃБрЃџрЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃўрЃА, рЃњрЃљрЃцрЃўрЃџрЃбрЃЋрЃарЃљ рЃерЃћрЃЏрЃЊрЃњрЃЮрЃЏ рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃЊрЃљ рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃўрЃА рЃњрЃљрЃбрЃљрЃюрЃљ, рЃарЃљ рЃњрЃљрЃарЃћрЃЏрЃЮрЃерЃўрЃљ рЃњрЃљрЃерЃЋрЃћрЃЉрЃБрЃџрЃў рЃћрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃў  рЃЊрЃљ рЃљ.рЃе. рЃљрЃдрЃљрЃа рЃЕрЃљрЃЋрЃљрЃџ рЃАрЃўрЃдрЃарЃЏрЃћрЃћрЃЉрЃерЃў.
рЃћрЃАрЃћрЃўрЃњрЃў рЃЕрЃЋрЃћрЃюрЃА рЃњрЃљрЃАрЃљрЃерЃЋрЃћрЃЉ рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃА рЃЏрЃЮрЃЋрЃБрЃФрЃћрЃЉрЃюрЃћрЃЌ рЃърЃЮрЃарЃбрЃў, рЃ«рЃЮрЃџрЃЮ рЃЎрЃЮрЃюрЃАрЃБрЃџрЃА рЃњрЃљрЃЋрЃљрЃљрЃбрЃюрЃћрЃЌ рЃЏрЃўрЃАрЃў, рЃарЃЮрЃњрЃЮрЃарЃф рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА `рЃАрЃљрЃ«рЃћрЃџрЃў`, `id`, `address`, `port`,`tags`.
рЃЏрЃЮрЃЊрЃў рЃњрЃљрЃЋрЃљрЃњрЃарЃФрЃћрЃџрЃЮрЃЌ...

```js title="app.js"
import { createServer } from 'http';
import Consul from 'consul';
import portfinder from 'portfinder';
import { nanoid } from 'nanoid';

// рЃЊрЃљрЃЋрЃўрЃГрЃўрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃбрЃўрЃърЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃЌ
const serviceType = process.argv[2];

const { pid } = process;

async function main() {
	const consulClient = new Consul();

	// РЉа Discover a free port in the system and generate a unique service ID
	const port = await portfinder.getPortPromise();
	const address = process.env.ADDRESS || "localhost";
	const serviceId = nanoid();
	function registerService() {
		consulClient.agent.service.register(
			{
				id: serviceId,
				name: serviceType,
				address,
				port,
				tags: [serviceType],
			},
			() => {
				console.log(`${serviceType} registered successfully`);
			}
		);
	}

```

рЃћрЃ«рЃџрЃљ рЃЊрЃљрЃЋрЃгрЃћрЃарЃЮрЃЌ рЃљрЃЏ рЃАрЃћрЃарЃЋрЃўрЃАрЃў рЃљрЃЏрЃЮрЃдрЃћрЃЉрЃљ,рЃгрЃљрЃерЃџрЃљрЃА рЃЎрЃЮрЃюрЃАрЃБрЃџрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃЊрЃљрЃю.рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃЏрЃўрЃќрЃљрЃюрЃў рЃљрЃЏ рЃцрЃБрЃюрЃфрЃЦрЃўрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃўрЃЦрЃюрЃћрЃЉрЃљ рЃўрЃА,рЃарЃЮрЃЏ рЃЌрЃБ рЃАрЃљрЃГрЃўрЃарЃЮ рЃњрЃљрЃ«рЃЊрЃљ 
рЃАрЃћрЃарЃЋрЃўрЃАрЃў рЃњрЃљрЃЏрЃЮрЃарЃЌрЃЋрЃљ рЃљрЃю рЃЌрЃБ рЃћрЃарЃЮрЃарЃў рЃЏрЃЮрЃ«рЃЊрЃљ,рЃљрЃю рЃарЃљрЃўрЃЏрЃћ рЃћрЃЦрЃАрЃћрЃцрЃерЃћрЃюрЃў рЃњрЃљрЃўрЃАрЃарЃЮрЃџрЃљ рЃЕрЃЋрЃћрЃюрЃў рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃЏрЃљ, рЃБрЃюрЃЊрЃљ рЃгрЃљрЃўрЃерЃљрЃџрЃЮрЃА рЃћрЃА рЃАрЃћрЃарЃЋрЃўрЃАрЃў рЃЎрЃЮрЃюрЃАрЃБрЃџрЃўрЃЊрЃљрЃю рЃАрЃљрЃюрЃљрЃЏ рЃЌрЃљрЃЋрЃљрЃЊ рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃЏрЃЮрЃЎрЃЋрЃЊрЃћрЃЉрЃљ.


```js title="app.js"
import { createServer } from 'http';
import Consul from 'consul';
import portfinder from 'portfinder';
import { nanoid } from 'nanoid';

// рЃЊрЃљрЃЋрЃўрЃГрЃўрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃбрЃўрЃърЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃЌ
const serviceType = process.argv[2];

const { pid } = process;

async function main() {
	const consulClient = new Consul();

	// РЉа Discover a free port in the system and generate a unique service ID
	const port = await portfinder.getPortPromise();
	const address = process.env.ADDRESS || "localhost";
	const serviceId = nanoid();
	function registerService() {
		consulClient.agent.service.register(
			{
				id: serviceId,
				name: serviceType,
				address,
				port,
				tags: [serviceType],
			},
			() => {
				console.log(`${serviceType} registered successfully`);
			}
		);
	}

	function unregisterService(err) {
		err && console.error(err);
		onsole.log(`deregistering ${serviceId}`);
		consulClient.agent.service.deregister(serviceId, () => {
			process.exit(err ? 1 : 0);
		});
	}


	// рЃЊрЃљрЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЮрЃЌ
	process.on("exit", unregisterService);
	process.on("uncaughtException", unregisterService);
	process.on("SIGINT", unregisterService);

```

рЃљрЃ«рЃџрЃљ рЃЎрЃў рЃЉрЃЮрЃџрЃЮ рЃћрЃбрЃљрЃърЃў, рЃерЃћрЃЋрЃЦрЃЏрЃюрЃљрЃЌ `HTTP` рЃАрЃћрЃарЃЋрЃћрЃарЃў, рЃюрЃЮрЃБрЃЊрЃўрЃА `http` рЃЏрЃЮрЃЊрЃБрЃџрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ, рЃЊрЃљрЃЋрЃАрЃЋрЃљрЃЌ рЃЕрЃЋрЃћрЃюрЃА рЃърЃЮрЃарЃбрЃќрЃћ рЃЊрЃљ рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃќрЃћ, рЃЊрЃљ рЃАрЃўрЃЏрЃБрЃџрЃљрЃфрЃўрЃљ рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃЮрЃЌ 
рЃЌрЃўрЃЌрЃЦрЃЮрЃА рЃарЃћрЃЦрЃЋрЃћрЃАрЃбрЃћрЃЉрЃў рЃерЃћрЃЏрЃЮрЃЊрЃўрЃА рЃљрЃЏ рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃќрЃћ.



```js title="app.js"
import { createServer } from 'http';
import Consul from 'consul';
import portfinder from 'portfinder';
import { nanoid } from 'nanoid';

// рЃЊрЃљрЃЋрЃўрЃГрЃўрЃарЃЮрЃЌ рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃбрЃўрЃърЃў, рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф рЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃЌ
const serviceType = process.argv[2];

const { pid } = process;

async function main() {
	const consulClient = new Consul();

	// РЉа Discover a free port in the system and generate a unique service ID
	const port = await portfinder.getPortPromise();
	const address = process.env.ADDRESS || "localhost";
	const serviceId = nanoid();
	function registerService() {
		consulClient.agent.service.register(
			{
				id: serviceId,
				name: serviceType,
				address,
				port,
				tags: [serviceType],
			},
			() => {
				console.log(`${serviceType} registered successfully`);
			}
		);
	}

	function unregisterService(err) {
		err && console.error(err);
		onsole.log(`deregistering ${serviceId}`);
		consulClient.agent.service.deregister(serviceId, () => {
			process.exit(err ? 1 : 0);
		});
	}


	// рЃЊрЃљрЃЋрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЮрЃЌ рЃЊрЃћрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃћрЃЉрЃўрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ
	process.on("exit", unregisterService);
	process.on("uncaughtException", unregisterService);
	process.on("SIGINT", unregisterService);


	const server = createServer((req, res) => {
		let i = 1e7;
		while (i > 0) {
		  i--;
		}
		console.log(`Handling request from ${pid}`);
		res.end(`${serviceType} response from ${pid}\n`);
	});

	server.listen(port, address, () => {
		registerService();
		console.log(`Started ${serviceType} at ${pid} on port ${port}`);
	});
```

рЃћрЃА рЃўрЃДрЃЮ рЃЕрЃЋрЃћрЃюрЃў рЃўрЃюрЃАрЃбрЃљрЃюрЃАрЃўрЃА рЃарЃЮрЃњрЃЮрЃарЃф рЃАрЃћрЃарЃЋрЃўрЃАрЃўрЃА рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃљрЃљ рЃЊрЃљ рЃЏрЃўрЃАрЃў рЃЊрЃљрЃ»рЃћрЃюрЃљ рЃњрЃљрЃЏрЃЮрЃДрЃЮрЃцрЃўрЃџ рЃБрЃюрЃўрЃЎрЃљрЃџрЃБрЃа рЃърЃЮрЃарЃбрЃАрЃљ рЃЊрЃљ рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃќрЃћ.

рЃљрЃ«рЃџрЃљ, рЃњрЃљрЃЊрЃљрЃЋрЃўрЃЊрЃћрЃЌ рЃЏрЃћрЃЮрЃарЃћ рЃюрЃљрЃгрЃўрЃџрЃќрЃћ. рЃЊрЃљрЃЋрЃгрЃћрЃарЃЮрЃЌ рЃџрЃЮрЃљрЃЊ-рЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃарЃў, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃерЃћрЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџ рЃарЃћрЃЦрЃЋрЃћрЃАрЃбрЃћрЃЉрЃА рЃњрЃљрЃЊрЃљрЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃА рЃАрЃ«рЃЋрЃљрЃЊрЃљрЃАрЃ«рЃ«рЃЋрЃљ рЃАрЃћрЃарЃЋрЃўрЃАрЃћрЃЉрЃќрЃћ,рЃўрЃЏрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ
рЃЌрЃБ рЃа
